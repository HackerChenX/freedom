# 回测结果转换选股策略指南

## 1. 概述

本指南旨在规范从回测结果到可配置选股策略的转换过程，确保回测中发现的有效信号和模式能够完整地保留在生成的选股策略中。转换过程应当保留回测中发现的所有有价值的指标和条件，不做任何简化，以确保策略的有效性和准确性。

## 2. 回测结果标准输出格式

回测结果应包含以下核心部分：

### 2.1 技术形态统计

列出所有在回测中出现的技术形态，并按出现频率排序。至少包含：
- 形态名称
- 出现频率
- 成功率（盈利次数/出现次数）
- 平均收益率
- 最大收益率
- 最大回撤率

### 2.2 跨周期共性特征

按以下分类列出在多个周期中共同出现的形态：
- 跨周期形态：同时在多个周期（如15分钟、30分钟、日线等）出现的形态
- 强信号形态：同时在日线及以上周期（日线、周线、月线）出现的形态

### 2.3 各周期详细分析

对每个周期（15分钟、30分钟、60分钟、日线、周线、月线）进行详细分析：
- 形态列表：该周期出现的所有形态
- 指标数据：所有技术指标的详细数据（值、前期值、变化率等）
- 指标评分：每类指标的评分（0-100分）

### 2.4 结论和建议

- 最常见的技术形态（至少5个）
- 建议的交易策略
- 风险提示

## 3. 选股策略采纳标准

从回测结果转换为选股策略时，应遵循以下标准：

### 3.1 指标选择标准

以下指标**必须**被纳入选股策略：

1. **出现在"最常见的技术形态"中的所有指标**
   - 这些指标在回测中表现最为显著，应当全部保留

2. **成功率高于70%的所有指标**
   - 无论出现频率如何，高成功率指标都具有预测价值

3. **同时出现在3个或更多周期的指标**
   - 跨周期共振的指标具有更强的可靠性

4. **所有ZXM体系指标**
   - 包括但不限于：ZXM吸筹、ZXM换手买点、ZXM日MACD买点、ZXM回踩均线买点、ZXM涨幅弹性、ZXM振幅弹性、ZXM弹性满足、ZXM买点满足、ZXM趋势满足等

5. **所有在回测中评分超过75分的指标**
   - 高评分指标表明其在回测中表现优异

### 3.2 逻辑条件构建

策略中的逻辑条件应按以下方式构建：

1. **基础逻辑条件**
   - 最常见形态的指标之间使用OR逻辑连接（满足其中任一条件即可）
   - 成功率高的指标（>85%）可单独作为条件

2. **分组逻辑**
   - 按指标类型进行分组（趋势类、动量类、价量类、形态类、ZXM体系类等）
   - 每组内部使用OR逻辑，组间可使用AND或OR逻辑

3. **加权评分系统**
   - 对于复杂的多指标策略，应实现加权评分系统
   - 权重分配应基于回测中的成功率和收益率

### 3.3 参数设置

1. **使用回测中表现最佳的参数设置**
   - 不应简化或默认化参数
   - 对关键参数可提供合理的范围而非单一值

2. **ZXM体系指标参数**
   - ZXM指标的参数应与回测中使用的参数保持一致
   - 不得简化或省略任何ZXM指标的辅助条件

## 4. 策略转换流程

### 4.1 数据提取阶段

1. 从回测结果中提取所有符合3.1条件的指标
2. 提取这些指标在回测中使用的准确参数
3. 提取这些指标的评分和表现数据

### 4.2 策略构建阶段

1. 按指标类型分组构建基础条件
2. 构建逻辑关系（根据3.2节）
3. 设置参数（根据3.3节）

### 4.3 验证阶段

1. 使用历史数据验证转换后的策略
2. 计算策略在回测样本上的表现与原回测结果的一致性
3. 确保一致性达到95%以上

## 5. 策略文件格式

生成的策略配置文件应包含：

```yaml
strategy:
  id: [唯一标识符]
  name: [策略名称]
  description: [策略描述，包含来源回测标识]
  version: [版本号]
  author: [作者]
  create_time: [创建时间]
  update_time: [更新时间]

  conditions:
    # 按原回测中的重要性排序
    - indicator_id: [指标1ID]
      period: [周期]
      parameters:
        [参数1]: [值1]
        [参数2]: [值2]
      signal_type: [信号类型]
    
    - logic: [逻辑操作符]
    
    # 更多指标...

  filters:
    market: [市场过滤]
    industry: [行业过滤]
    market_cap:
      min: [最小市值]
      max: [最大市值]
    price:
      min: [最小价格]
      max: [最大价格]

  sort:
    - field: [排序字段1]
      direction: [排序方向]
    - field: [排序字段2]
      direction: [排序方向]
```

## 6. 示例

### 6.1 回测结果示例片段

```
最常见的技术形态:
1. ZXM换手买点 (频率: 85%, 成功率: 78%)
2. ZXM涨幅弹性 (频率: 82%, 成功率: 75%)
3. ZXM弹性满足 (频率: 80%, 成功率: 73%)
4. ZXM买点满足 (频率: 78%, 成功率: 76%)
5. MACD底背离 (频率: 75%, 成功率: 72%)
6. ZXM吸筹 (频率: 70%, 成功率: 82%)
```

### 6.2 对应的策略配置

```yaml
strategy:
  id: BACKTEST_STRATEGY_001
  name: 回测策略
  description: 基于回测结果生成的策略 - 源自zxm_batch_backtest_20250525_223702
  version: "1.0"
  author: system
  create_time: "2025-05-27 17:13:45"
  update_time: "2025-05-27 17:20:00"

  conditions:
    # ZXM换手买点
    - indicator_id: ZXM_TURNOVER
      period: DAILY
      parameters:
        turnover_threshold: 1.0
      signal_type: BUY
    
    - logic: OR
    
    # ZXM涨幅弹性
    - indicator_id: ZXM_RISE_ELASTICITY
      period: DAILY
      parameters:
        threshold: 1.02
      signal_type: BUY
    
    - logic: OR
    
    # ZXM弹性满足
    - indicator_id: ZXM_ELASTICITY_SCORE
      period: DAILY
      parameters:
        threshold: 75
      signal_type: BUY
    
    - logic: OR
    
    # ZXM买点满足
    - indicator_id: ZXM_BUYPOINT_SCORE
      period: DAILY
      parameters:
        threshold: 75
      signal_type: BUY
    
    - logic: OR
    
    # MACD底背离
    - indicator_id: MACD
      period: DAILY
      parameters:
        fast_period: 12
        slow_period: 26
        signal_period: 9
        divergence: true
      signal_type: BUY
    
    - logic: OR
    
    # ZXM吸筹
    - indicator_id: ZXM_ABSORB
      period: DAILY
      parameters:
        threshold: 3
      signal_type: BUY

  filters:
    market: []  # 不限制市场
    industry: []  # 不限制行业
    market_cap:
      min: 0
      max: 10000
    price:
      min: 0
      max: 500

  sort:
    - field: signal_strength
      direction: DESC
    - field: market_cap
      direction: ASC
```

## 7. 注意事项

1. **完整性原则**：不得省略回测中任何表现良好的指标，特别是ZXM体系指标
2. **准确性原则**：指标参数必须与回测中使用的参数保持一致
3. **可追溯性原则**：策略描述中必须包含源回测的标识，以便追溯
4. **验证原则**：每个生成的策略必须通过验证，确保与原回测结果的一致性
5. **动态适应原则**：策略应当能够动态适应市场变化，避免过度拟合

## 8. 常见问题

1. **问题**：回测中的某些指标在系统中没有实现怎么办？
   **解答**：应当优先实现这些指标，或寻找最接近的替代指标，并在策略描述中注明。

2. **问题**：回测中有数十个有效指标，是否全部纳入策略？
   **解答**：是的，应当全部纳入，可以通过适当的逻辑组合控制触发条件。

3. **问题**：ZXM体系指标是否必须纳入？
   **解答**：是的，所有在回测中出现的ZXM体系指标都必须纳入策略中，这些是核心指标。 