[模式：计划]

# 合并重复指标脚本计划

## 概述
我们需要合并多个类似的技术指标实现，将功能整合到单一脚本中，保留主要的脚本名称（不添加后缀），并删除合并后不再需要的脚本文件。合并工作不包括评分类的脚本（如 kdj_score.py 等）。

## 目标指标及脚本
根据研究结果，需要合并的指标脚本包括：

1. MACD指标：
   - macd.py 和 macd_new.py（内容相同）
   - enhanced_macd.py

2. RSI指标：
   - rsi.py
   - rsi_new.py
   - enhanced_rsi.py
   - rsi_derivatives.py
   - stochrsi.py
   - rsima.py

3. MA（移动平均线）指标：
   - ma.py
   - ma_new.py
   - unified_ma.py
   - ema.py
   - wma.py

4. KDJ指标：
   - kdj.py
   - enhanced_kdj.py（在 indicators/oscillator 目录下）

## 合并策略
对于每个指标类型，我们将：
1. 以主要脚本（如 macd.py, rsi.py 等）为基础
2. 整合其他脚本中的增强功能和特殊功能
3. 确保向后兼容性，不破坏现有API
4. 使用继承或组合模式组织代码，保持清晰的类层次结构
5. 保留完整的文档字符串和注释

## 详细计划

### 1. MACD指标合并

#### 1.1 分析文件内容
- 分析 macd.py 和 enhanced_macd.py 的功能差异
- 确定哪些功能需要整合到新的 macd.py 中

#### 1.2 合并文件
- 以 macd.py 为基础，整合 enhanced_macd.py 的功能
- 确保 MACD 类支持所有原有功能，包括标准模式、增强模式和趋势增强模式
- 整合 EnhancedMACD 类的独特功能

#### 1.3 测试与清理
- 测试合并后的 macd.py 是否正常工作
- 删除 macd_new.py 和 enhanced_macd.py

### 2. RSI指标合并

#### 2.1 分析文件内容
- 分析 rsi.py, rsi_new.py, enhanced_rsi.py, rsi_derivatives.py, stochrsi.py, rsima.py 的功能差异
- 确定合并策略，是将所有功能整合到一个文件还是采用不同的组织方式

#### 2.2 合并文件
- 以 rsi_new.py 为基础（因其支持多种模式）
- 整合 enhanced_rsi.py 的增强功能
- 将 rsi_derivatives.py 中的 STOCHRSI 和 RSIMA 类整合进来
- 确保 RSI 类支持所有原有模式和功能

#### 2.3 测试与清理
- 测试合并后的 rsi.py 是否正常工作
- 删除 rsi_new.py, enhanced_rsi.py, rsi_derivatives.py, stochrsi.py, rsima.py

### 3. MA指标合并

#### 3.1 分析文件内容
- 分析 ma.py, ma_new.py, unified_ma.py, ema.py, wma.py 的功能差异
- 确定如何最好地组织不同的MA类型

#### 3.2 合并文件
- 以 unified_ma.py 为基础（因其整合了多种计算方法）
- 整合 ma.py 和 ma_new.py 中的特有功能
- 整合 ema.py 和 wma.py 中的专门功能
- 确保 MA 类支持所有类型的移动平均线计算

#### 3.3 测试与清理
- 测试合并后的 ma.py 是否正常工作
- 删除 ma_new.py, unified_ma.py, ema.py, wma.py

### 4. KDJ指标合并

#### 4.1 分析文件内容
- 分析 kdj.py 和 enhanced_kdj.py 的功能差异

#### 4.2 合并文件
- 以 kdj.py 为基础
- 整合 enhanced_kdj.py 的增强功能
- 确保 KDJ 类支持所有原有功能

#### 4.3 测试与清理
- 测试合并后的 kdj.py 是否正常工作
- 删除 indicators/oscillator/enhanced_kdj.py

## 实施顺序
1. MACD指标合并
2. RSI指标合并
3. MA指标合并
4. KDJ指标合并

## 注意事项
- 确保导入语句正确更新
- 保留所有原始功能
- 不破坏现有API
- 添加适当的注释说明合并情况
- 每个步骤完成后进行测试

IMPLEMENTATION CHECKLIST:
1. 分析并合并MACD指标（macd.py 和 enhanced_macd.py）到 macd.py
2. 测试合并后的 macd.py
3. 删除 macd_new.py 和 enhanced_macd.py
4. 分析并合并RSI指标（rsi.py, rsi_new.py, enhanced_rsi.py, rsi_derivatives.py, stochrsi.py, rsima.py）到 rsi.py
5. 测试合并后的 rsi.py
6. 删除 rsi_new.py, enhanced_rsi.py, rsi_derivatives.py, stochrsi.py, rsima.py
7. 分析并合并MA指标（ma.py, ma_new.py, unified_ma.py, ema.py, wma.py）到 ma.py
8. 测试合并后的 ma.py
9. 删除 ma_new.py, unified_ma.py, ema.py, wma.py
10. 分析并合并KDJ指标（kdj.py 和 enhanced_kdj.py）到 kdj.py
11. 测试合并后的 kdj.py
12. 删除 indicators/oscillator/enhanced_kdj.py
