# 增强指标使用指南

本文档介绍了新增的增强版技术指标的使用方法和功能特性，这些指标对标准指标进行了扩展，增加了更多的信号生成和分析功能。

## 目录

- [统一移动平均线（UnifiedMA）](#统一移动平均线unified_ma)
- [增强版MACD（EnhancedMACD）](#增强版macdenhancd_macd)
- [增强版RSI（EnhancedRSI）](#增强版rsienhancd_rsi)
- [指标协同使用案例](#指标协同使用案例)

## 统一移动平均线（UNIFIED_MA）

统一移动平均线整合了多种均线算法，提供了更丰富的趋势分析能力。

### 主要特性

1. 支持多种均线类型：
   - 简单移动平均线 (SMA)
   - 指数移动平均线 (EMA)
   - 加权移动平均线 (WMA)
   - 自适应移动平均线 (AMA)
   - Hull移动平均线 (HMA)

2. 趋势判断功能：
   - 多头排列/空头排列判断
   - 均线斜率判断
   - 盘整区域识别

3. 丰富的信号生成：
   - 价格与均线交叉信号
   - 均线之间交叉信号
   - 基于多条均线的买卖信号

### 参数说明

| 参数名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| periods | List[int] | [5, 10, 20, 30, 60] | 均线周期列表 |
| ma_type | str | 'simple' | 均线类型，可选值：'simple', 'ema', 'wma', 'ama', 'hma' |
| price_col | str | 'close' | 价格列名 |
| weight | float | 1 | SMA的权重参数 |
| fast_period | int | 2 | AMA快速周期 |
| slow_period | int | 30 | AMA慢速周期 |
| efficiency_period | int | 10 | AMA效率系数计算周期 |

### 使用示例

```python
from indicators.unified_ma import UnifiedMA

# 创建统一移动平均线实例
ma = UnifiedMA(
    periods=[5, 10, 20, 30, 60],
    ma_type='ema',  # 使用指数移动平均线
    price_col='close'
)

# 计算指标
result = ma.compute(data)

# 生成信号
signals = ma.generate_signals(data)

# 判断是否为盘整区域
is_consolidation = ma.is_consolidation(period=20, threshold=0.01)

# 获取均线趋势
trend = ma.get_ma_trend(period=20)
```

### 适用场景

1. **趋势判断**：利用不同类型均线各自的优势判断价格趋势
2. **盘整区域识别**：通过均线变化率识别盘整区域
3. **趋势启动点判断**：通过Hull均线等敏感均线捕捉趋势启动
4. **多周期分析**：通过多条均线的关系分析市场结构

## 增强版MACD（ENHANCED_MACD）

增强版MACD在标准MACD基础上增加了背离检测、双MACD验证等高级功能。

### 主要特性

1. 精确的背离检测：
   - 看涨背离（价格创新低但MACD未创新低）
   - 看跌背离（价格创新高但MACD未创新高）
   - 隐藏背离检测
   - 背离强度计算

2. 双MACD协同验证：
   - 支持配置两组MACD参数
   - 双MACD同时产生信号时增强确认度
   - 提供多种协同状态判断

3. 增强的信号生成：
   - 柱状图颜色变化确认
   - 零轴交叉信号
   - 信号强度评分

### 参数说明

| 参数名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| fast_period | int | 12 | 快线周期 |
| slow_period | int | 26 | 慢线周期 |
| signal_period | int | 9 | 信号线周期 |
| price_col | str | 'close' | 价格列名 |
| use_secondary_macd | bool | False | 是否使用第二组MACD |
| secondary_fast | int | 5 | 第二组MACD快线周期 |
| secondary_slow | int | 35 | 第二组MACD慢线周期 |
| secondary_signal | int | 5 | 第二组MACD信号线周期 |
| divergence_window | int | 20 | 背离检测窗口大小 |
| divergence_threshold | float | 0.01 | 背离强度阈值 |
| smoothing_period | int | 3 | MACD平滑周期 |
| histogram_color_change | bool | True | 是否计算柱状图颜色变化 |

### 使用示例

```python
from indicators.enhanced_macd import EnhancedMACD

# 创建增强版MACD实例
macd = EnhancedMACD(
    fast_period=12,
    slow_period=26,
    signal_period=9
)

# 启用双MACD
macd.set_parameters({
    'use_secondary_macd': True,
    'secondary_fast': 5,
    'secondary_slow': 35,
    'secondary_signal': 5
})

# 计算指标
result = macd.compute(data)

# 生成信号
signals = macd.generate_signals(data)

# 绘制MACD
import matplotlib.pyplot as plt
fig, ax = plt.subplots(figsize=(12, 6))
macd.plot_macd(data, ax=ax, show_divergence=True)
plt.show()
```

### 适用场景

1. **背离交易**：精确识别MACD背离，捕捉价格反转机会
2. **趋势确认**：通过双MACD协同验证，提高趋势判断准确性
3. **动量分析**：通过MACD柱状图变化，评估价格动量强度
4. **零轴分析**：利用DIF穿越零轴信号，判断中期趋势变化

## 增强版RSI（ENHANCED_RSI）

增强版RSI添加了多周期协同分析、中枢识别和背离检测等功能。

### 主要特性

1. 多周期RSI协同分析：
   - 支持同时计算多个周期的RSI
   - 提供RSI趋势一致性指标
   - 加权RSI强度计算

2. 区域与状态判断：
   - 超买超卖状态识别
   - 中枢区域判断
   - RSI趋势变化检测

3. 背离检测：
   - 精确识别RSI背离
   - 背离强度计算
   - 自动过滤弱背离信号

### 参数说明

| 参数名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| periods | List[int] | [6, 14, 21] | RSI周期列表 |
| price_col | str | 'close' | 价格列名 |
| overbought_threshold | int | 70 | 超买阈值 |
| oversold_threshold | int | 30 | 超卖阈值 |
| center_low | int | 40 | 中枢区域下限 |
| center_high | int | 60 | 中枢区域上限 |
| smooth_period | int | 3 | RSI平滑周期 |
| divergence_window | int | 20 | 背离检测窗口大小 |
| divergence_threshold | float | 0.1 | 背离强度阈值 |
| use_multi_period | bool | True | 是否使用多周期协同 |

### 使用示例

```python
from indicators.enhanced_rsi import EnhancedRSI

# 创建增强版RSI实例
rsi = EnhancedRSI(
    periods=[6, 14, 21],
    price_col='close'
)

# 设置参数
rsi.set_parameters({
    'overbought_threshold': 75,
    'oversold_threshold': 25
})

# 计算指标
result = rsi.compute(data)

# 生成信号
signals = rsi.generate_signals(data)

# 绘制RSI
import matplotlib.pyplot as plt
fig, ax = plt.subplots(figsize=(12, 6))
rsi.plot_rsi(data, ax=ax, show_divergence=True)
plt.show()
```

### 适用场景

1. **超买超卖反转**：利用RSI超买超卖区域信号，捕捉价格反转机会
2. **多周期确认**：通过短中长期RSI协同分析，提高信号可靠性
3. **趋势强度评估**：利用RSI动量和RSI强度，评估价格趋势强度
4. **背离交易**：精确识别RSI背离，预测可能的价格走势变化

## 指标协同使用案例

以下是几个结合使用增强指标的案例，帮助构建更强大的交易策略。

### 案例1：多指标协同确认趋势

```python
from indicators.unified_ma import UnifiedMA
from indicators.enhanced_macd import EnhancedMACD
from indicators.enhanced_rsi import EnhancedRSI

# 初始化指标
ma = UnifiedMA(periods=[5, 10, 20, 60], ma_type='ema')
macd = EnhancedMACD(use_secondary_macd=True)
rsi = EnhancedRSI(periods=[6, 14, 21])

# 计算指标
ma_result = ma.compute(data)
macd_result = macd.compute(data)
rsi_result = rsi.compute(data)

# 生成各自信号
ma_signals = ma.generate_signals(data)
macd_signals = macd.generate_signals(data)
rsi_signals = rsi.generate_signals(data)

# 协同买入信号：所有指标同时看涨
buy_signals = (
    ma_signals['bull_trend'] &              # 均线多头排列
    (macd_result['DIF'] > macd_result['DEA']) &  # MACD金叉后
    (rsi_result['RSI_consensus'] > 0) &     # RSI一致上升
    ~macd_result['bearish_divergence']      # 无MACD顶背离
)

# 协同卖出信号：所有指标同时看跌
sell_signals = (
    ma_signals['bear_trend'] &              # 均线空头排列
    (macd_result['DIF'] < macd_result['DEA']) &  # MACD死叉后
    (rsi_result['RSI_consensus'] < 0) &     # RSI一致下降
    ~macd_result['bullish_divergence']      # 无MACD底背离
)
```

### 案例2：背离交易策略

```python
from indicators.enhanced_macd import EnhancedMACD
from indicators.enhanced_rsi import EnhancedRSI

# 初始化指标
macd = EnhancedMACD(divergence_threshold=0.015)
rsi = EnhancedRSI(divergence_threshold=0.12)

# 计算指标
macd_result = macd.compute(data)
rsi_result = rsi.compute(data)

# 双重背离确认
bullish_divergence = (
    macd_result['bullish_divergence'] &  # MACD底背离
    rsi_result['bullish_divergence']     # RSI底背离
)

bearish_divergence = (
    macd_result['bearish_divergence'] &  # MACD顶背离
    rsi_result['bearish_divergence']     # RSI顶背离
)

# 背离强度评分（0-100）
bullish_score = 50 + (
    (macd_result['divergence_strength'] * 200) +
    (rsi_result['divergence_strength'] * 300)
).clip(0, 50)

bearish_score = 50 - (
    (macd_result['divergence_strength'] * 200) +
    (rsi_result['divergence_strength'] * 300)
).clip(0, 50)
```

### 案例3：均线与震荡指标结合策略

```python
from indicators.unified_ma import UnifiedMA
from indicators.enhanced_rsi import EnhancedRSI

# 初始化指标
ma = UnifiedMA(periods=[5, 10, 20, 60], ma_type='hma')  # 使用Hull均线提高敏感度
rsi = EnhancedRSI(periods=[6, 14, 21])

# 计算指标
ma_result = ma.compute(data)
rsi_result = rsi.compute(data)
ma_signals = ma.generate_signals(data)

# 趋势过滤的RSI策略
filtered_rsi_buy = (
    rsi_result['RSI14'] < 40 &                  # RSI低位
    rsi_result['RSI14_cross_up_30'] &           # RSI上穿超卖线
    ma_signals['price_above_MA60'] &            # 价格在长期均线上方
    (ma.get_ma_trend(period=20) > 0)            # 中期均线向上
)

filtered_rsi_sell = (
    rsi_result['RSI14'] > 60 &                  # RSI高位
    rsi_result['RSI14_cross_down_70'] &         # RSI下穿超买线
    ma_signals['price_below_MA60'] &            # 价格在长期均线下方
    (ma.get_ma_trend(period=20) < 0)            # 中期均线向下
)

# 增加盘整区域判断
consolidation = ma.is_consolidation(period=20, threshold=0.005)
```

以上案例展示了如何组合使用这些增强指标，构建更加精细和可靠的交易策略。您可以根据自己的需求，调整参数和组合方式，开发适合自己的交易系统。 