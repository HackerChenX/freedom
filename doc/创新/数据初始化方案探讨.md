[模式：创新]

## 数据初始化方案探讨

在[研究]阶段，我们识别出`init_database`方法缺失是当前数据初始化流程的核心障碍。本阶段旨在探讨并确定最佳的解决方案。

### 可能性 1：直接在`clickhouse_db.py`中硬编码SQL

- **描述**: 在`ClickHouseDB`类中重新实现`init_database`方法，并将`CREATE DATABASE`和`CREATE TABLE`的SQL语句直接硬编码在方法内部。
- **优点**:
    - **快速简单**: 实现成本最低，改动范围最小。
    - **逻辑内聚**: 无需依赖外部`.sql`文件。
- **缺点**:
    - **可维护性差**: 表结构变更需要直接修改Python代码，违反了配置与代码分离的最佳实践。
    - **不灵活**: 难以扩展，未来如果需要创建更多表，方法会变得臃肿。
    - **违反规范**: 与项目架构规范中"SQL文件放置在`sql`目录下"的规定相冲突。

### 可能性 2：读取并执行`sql/`目录下的SQL文件

- **描述**: 在`ClickHouseDB`类中实现`init_database`方法，使其能够读取`sql/`目录下的一个或多个`.sql`文件，并逐一执行其中的SQL语句。
- **优点**:
    - **代码与配置分离**: SQL逻辑与Python代码解耦，修改表结构只需编辑`.sql`文件。
    - **可维护性好**: 遵循项目架构规范，便于管理和维护。
    - **灵活可扩展**: 可以通过增删`.sql`文件轻松管理多个表的创建。
- **缺点**:
    - **实现稍复杂**: 需要增加文件读取和解析逻辑。
    - **增加文件依赖**: 运行环境需确保`.sql`文件的存在和可访问性。

### 可能性 3：利用ORM或迁移工具

- **描述**: 引入一个成熟的数据库迁移工具（如`Alembic`）或利用ORM（对象关系映射）的部分功能来管理数据库模式的演进。
- **优点**:
    - **功能强大**: 支持数据库模式的版本控制、自动生成迁移脚本、回滚等高级功能。
    - **高度自动化**: 能够系统地管理数据库架构的整个生命周期。
    - **行业标准**: 是许多大型项目的标准实践，有丰富的社区支持。
- **缺点**:
    - **引入新依赖**: 会为项目增加新的第三方库依赖，增加整体复杂性。
    - **学习曲线**: 团队成员需要投入时间学习新工具的使用。
    - **过度设计**: 对于当前项目的需求来说，可能有些功能过剩，不够轻量。

### 结论与建议

综合评估以上三种可能性，**方案二（读取并执行SQL文件）**被认为是当前最合适的解决方案。

该方案在实现简单性、可维护性和遵循项目既定规范之间取得了最佳平衡。虽然比硬编码SQL稍显复杂，但其带来的长期收益（如易于维护和扩展）是显著的。与此同时，它避免了引入重型迁移工具所带来的额外复杂性和学习成本，保持了项目的轻量化。

因此，我建议采纳方案二，在`db/clickhouse_db.py`中实现一个新的`init_database`方法，该方法将负责读取并执行`sql/`目录下的SQL文件，以完成数据库的自动化初始化。 